[
    "好，各位同学，大家好啊",
    "这一小节呢，我们来跟大家一起去学习",
    "或者叫复习一下",
    "因为很多同学在这个业务当中",
    "已经用的比较多了",
    "就是如何在建表的时候对数据进行约束",
    "也就是说一些业务上不应该出现的这个异常数据",
    "如何在这个表的插入规则的时候",
    "就把它给禁掉",
    "就把它给杜绝掉",
    "我们看一下 inno dB 约束数据",
    "大概有什么方法啊",
    "比如说 primary key ，有那个 K ",
    "也就是说唯一的主键",
    "或者是这个唯一的索引这种字段",
    "如果它变成了主键或者是唯一索引",
    "它就不可能插入重复的值",
    "这就是这个印度 dB 数据表",
    "给我们业务提供了一个校验的功能",
    "如果你把它变成唯一索引的话",
    "你插入重复的值",
    "它就会报错",
    "这就是帮你的业务去约束数据",
    "还有一个是外键",
    "外键也是约束数据",
    "在别的表存在不存在的一个方式啊",
    "还有 default 和 not now ",
    "也就是数据的默认值和数据是否可以为空",
    "还有一个是触发器",
    "我们一个个详细看一下",
    "第一个就是主键和唯一索引啊",
    "也就是说，我们通过将数据字段设置为主键",
    "或者设置为唯一索引",
    "可以约束数据的内容",
    "主键就是唯一的",
    "这个字段不能重复",
    "而且不能为空",
    "唯一辅助索引呢",
    "就是它是唯一的",
    "这样的话就可以约束我们的业务啊",
    "在业务规则里面不应该出现相同记录的时候",
    "插入数据库的时候他就会报错",
    "也是辅助业务的一个方法",
    "但是这个主键和唯一索引的问题在于",
    "唯一约束插入时的性能开销非常大",
    "为什么会大呢",
    "是因为插入的时候",
    "它要检查字段是不是唯一的",
    "如果不是唯一索引",
    "要么他是个普通索引",
    "要么它就不是索引",
    "插入的时候就不需要检查",
    "这个字段现在跟别人冲突不冲突",
    "这是它性能开销大的原因",
    "如果不需要检查的话",
    "这个字段直接写到缓存里就行",
    "如果要检查的话",
    "不光要写到缓存里",
    "他还要检查",
    "在我们这个第四章",
    "有一些内容会涉及",
    "大家理解这个问题就行",
    "下一个呢，是 foreign k ",
    "就是外界外键",
    "是可以对数据的正确性进行约束的",
    "比如说我插入一个表的时候",
    "这个表的一个字段是一个外界",
    "那这个字段在另一个表也是存在的",
    "这样的话就可以保证什么呀",
    "我不会插入错的数据",
    "比如说这个字段的值应该在另一个表里也出现",
    "但是它没有",
    "如果没有外界约束的话",
    "我可能会插入到错的",
    "如果有的话就会保证这一点",
    "但是很多公司是让严禁开发使用外键",
    "还要说一个",
    "或者是谨慎使用外键的",
    "因为第一，外键也是影响性能的",
    "第二，外界在数据异常修复的时候",
    "它是有问题的",
    "比如说我设了很多外界",
    "但是数据有一些异常的 D 、 B 、 A ",
    "或者开发同学要上去手动修的话",
    "就比较麻烦",
    "因为要涉及到这个数据之间的，呃，表",
    "每个表数据之间的这个约束问题",
    "下一个就是默认值和空校验的问题啊",
    "这个 default 就是我们建表的时候",
    "在每一个数据的字段定义后面会跟一个 default ",
    "有的时候写 default now ",
    "或有时候写 default 空字符串",
    "这个 default 就是数据的默认值",
    "也就是说，当我们插入数据的时候",
    "如果我们没有指定这个数据的值的话",
    "那它会用 default ",
    "后面跟的这个值",
    "大家在建表的时候已经用的非常多了啊",
    "也不需要咱们拿例子再看了",
    "还有一个 NO 和 not now 的问题",
    "这个在我们前面的小节啊",
    "我们也举过这个例子了",
    "你还记得那个判断",
    "如果没有显示的设主键的时候",
    "哪个是主键吗",
    "那 ABCD 那几个字段都有 not now 或者是 not ",
    "用来校验它可以为空还是不可以为空的",
    "那么在建表的时候",
    "我们一般都推荐主这个字段",
    "尽量的让它不为空",
    "尽量的约束它不为空",
    "如果一个字段为空的话",
    "如果我们把它这个字段建成了辅助索引",
    "这个索引就会出问题",
    "它的空字段是排不进索引的",
    "你想一个 B 加数",
    "它怎么以 now 作为一个数据的键呢",
    "所以如果一个字段里面它出现过空的话",
    "它的索引查询效率就会变低",
    "下一个呢，就是触发器",
    "触发器有些同学可能用过",
    "就是说在查询或者插入修改相应的特殊的字段的时候",
    "会触发一个你事先设好的一个存储过程",
    "或者一个逻辑",
    "那么触发器可以在插入修改特定的字段的时候",
    "用来校验我们的数据",
    "但是触发器它会干扰业务使用很少",
    "也就是说",
    "我们相当于把一部分的业务",
    "不放在业务应用里面",
    "放在 MYSQL 里面用触发器",
    "当我们插入一个数据的时候",
    "触发器出来进行校验",
    "这个反而而会使我们的业务流程难以理解",
    "本来要写在业务应用里面的逻辑",
    "你把它写在了 MYSQL 里面",
    "在这里多说一句",
    "老师早年间接触过一个项目",
    "这个项目它到什么程度呢",
    "就是它几乎所有的业务逻辑",
    "是写在 MYSQL 的存储过程里面",
    "前端和这个后台的业务逻辑非常非常少",
    "它所有的业务都是调 MYSQL 里面的存储过程",
    "所有的业务",
    "比如说增加订单呀",
    "减少订单呀",
    "订单过来之后怎么办",
    "给这个人加钱",
    "给那个人减钱",
    "所有的这种业务全放在 MYSQL 的触发器里面",
    "这种业务到了后来就没法维护了",
    "因为这个存储过程用来写业务逻辑",
    "非常恶心",
    "后来就不想用存储过程",
    "只能把这个存储过程",
    "再还原到我们业务应用里面",
    "当时用 java 把存储过程",
    "还原到业务应用里面的过程",
    "非常恶心",
    "所以说啊，这种触发器不要用太多",
    "可以用来处理一些极特殊的情况",
    "但是正常的业务还是不要用触发器洗",
    "总结一下今天的内容吧",
    "就是建表的时候呢",
    "我们可以有一些手段对数据进行一定的约束",
    "来辅助我们的业务应用",
    "有多重的数据约束的方法",
    "比如说这个将数据设为唯一索引字段",
    "可以约束数据的唯一性",
    "但是它的开销是比较大的",
    "因为它存数据的时候",
    "不能直接先放到缓存里面",
    "而是当时就要校验这个数据是不是唯一的啊",
    "最后呢，就是 default 这个关键字",
    "可以设置字段的默认值",
    "然后 now 和 not now ",
    "它可以设置字段是不是可以为空",
    "not not 就是不可能为空",
    "但是这里要注意一点",
    "就是这种 not now 的行为可能会受到 SQL mode 参数的影响",
    "如果我的 MYSQL 在严格模式的情况下",
    "它是可以开启 not 和 now 这种行为的",
    "如果是不严格模式的话",
    "你设置非空的约束",
    "这个字段也可以输入空参数。叫什么呢",
    "我们切到 terminal 上看一下",
    "这个参数就叫 inno dB strict mode ",
    "就是说印度 dB 的 SQL 是不是开启了严格模式",
    "我们查询一下",
    "如果是 on ",
    "说明他开启了严格模式",
    "我们对设置了不能为空字段插入空就会被禁止的",
    "如果它 off 了关掉了",
    "那么 not now 这个行为是没有用的",
    "大家注意这一点",
    "这一小节的内容就到这里",
    "谢谢大家",
    "4-9"
]