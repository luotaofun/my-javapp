["各位同学，大家好啊", "这一个小节呢，我们的标题是 where ", "查询太慢怎么办", "实际上呢，是我们要讲解啊", "覆盖索引是如何提高 SQL 查询的效率的", "覆盖索引这个概念呢，是这样的啊", "是指的查询语句", "从执行到返回结果均使用同一个索引", "那么覆盖索引可以有效地减少回表", "我说这个概念大家可能比较模糊", "不是特别的", "具体我给大家举个例子啊", "首先我们复制一下 socket 数据库里面的 inventory ", "大家就明白了", "inventory 是存货的意思啊", "存货的数据表", "去掉外界和联合索引", "用这个 SQL 语句来新建一个 inventor 杠一表", "那有同学说我怎么拿到这个 SQL 语句呢", "你就这样", "so create tables 啊", "然后", "用这个语句可以查看 inventory 这个表的建表语句啊", "我把它缩小一下", "这个就是它的建表语", "你把这个 create table 这个复制过来啊", "把这个联合索引的这个 K 给干掉啊", "复制过来之后呢", "我们这次干掉它的目的", "就是为了演示这个联合索引的作用在哪里", "所以我们要复制一个表", "是没有这个联合索引的", "把这两个额外键 cons 也干掉", "好，这样的话呢", "老师把这个 SQL 语句从 PPT 直接贴过来", "好，我们执行一下啊", "这个表就建好了是吧", "然后呢，我们再将 inventory ", "就是老表里面的数据也都贴过来", "用这个语句啊，叫 insert ", "insert into inventory 1对吧", "从哪 insert 进来呢", "从老的这个 inventory 表复制进来", "select 星", "from ", "invent 特尔就把 inventor 这个表复制到英特尔一里边所有的数据", "好，这样呢，我们的数据也都复制过来了对吧", "这两个表的最大区别就少了一个联合索引", "我们尝试一下查几个 SQL 语句", "看一下这个联合索引它能起到什么样的作用", "比如说啊，第一组语句", "语句都是一样的啊", "需要查询什么 store id 、 film id 在这两个表里面", "where store id 等于一", "我们先查第一个", "好，我们把这个 SQL 语句复制过来啊", "查出来对吧", "查询一下", "怎么看执行计划呢", "大家都知道啊", "用 explain ", "explain 就是查询他的执行计划", "好，执行计划过来了", "我缩小一下，太大了", "这个执行计划查询过来", "有同学说老师好像不太会看", "没问题啊", "我们这一章全都在看这个执行计划", "你看两次就知道这个执行计划怎么看了", "把它放大一下", "首先看啊", "possible kiss 是什么意思", "就是我的这个执行可能能用到哪些索引", "possible kiss now 就是用不到任何索引", "最后这个 key key 是走了什么索引", "最后也是没有走任何索引 now 对吧", "最后这个 extra extra 是 using where 啊", "就使用了 where 扫描", "也就是说这个查询语句没有走任何的索引", "走了扫描", "我们再查询一下相同的 SQL 语句", "查询原表", "好", "我把它缩小一下啊", "大家看查询原表是不是走了一个 possible kiss", "就走了一个索引", "走了一个索引", "而且大家注意这个 X 刷这里啊", "用了 using index ", "using index 在查询计划里面就叫索引覆盖", "也就是说使用了同一条索引", "同一条索引不需要回表", "使用一个", "所以就可以完成从数据的搜索到数据结果的返回", "这个操作老师解释一下为什么", "首先看这两张表", "它在索引上有什么区别", "输入 index ", "from inventory ", "来看缩小一下", "这样好看啊", "重新查一下啊", "好", "inventory 的表和 INVENTERR 杠一的表啊", "上面这个表是原始的", "这个又重新创建的对吧", "下面这个是我们啊", "我们重新创建的时候", "最主要是这个区别", "有一个组件", "有一个辅助索引啊", "辅助索引叫 index store id 、 film maid ", "也就是 store id 和 film id", "这两个字段组成的一个联合索引", "其中 store id 在联合索引里面排第一位", "form id 在联合索引里面排第二位", "而我们新建的这个表没有的", "他们的数据都是一样的", "好，这个是前提", "我们再看我们的 SQL 语句是什么呢", "然后找老师放大一下", "这样 select 什么 store id 、 film id from 这个表", "where store id 等于一", "什么意思呢", "大家看，首先它能不能用这个联合索引", "是可以用的", "为什么之前讲过啊", "只要他有带头大哥对吧", "联合索引的带头大哥是 store id 是吧", "后面是 film id ", "他是两个键组成的联合索引", "好，只要他有前面的这个也可以用走这条索引", "数据查询的时候他可以走", "然后数据查出来之后", "我请问他数据查出来是什么", "是符合 store id 等于一的所有记录的主键", "按理说是这样", "那我要查询", "又查了一个字段，对吧", "第一个 store id 这个字段有第二个 film id ", "我查两个字段", "按理来说我应该去回表", "拿到所有12 id 等于一的所有的组件", "去回我的居素索引", "也是回我的主索引", "去把这些数据全都查出来", "再把里面的 film id 拿出来", "这是正常的思路", "但是因为我们这是一条联合索引", "这个联合索引里面不光 store id ", "还有 film id ", "这样的话我们就不需要回表了", "这个联合索引长什么样子", "是不是跟我们上一次讲的这个麦当劳在一楼", "肯德基在二楼", "然后它们的值是什么", "它们的值是 key ", "就是组件是一样的", "这一条索引里面已经含有 so id 的信息", "已经含有 film id 的信息了", "而且可以走这条索引去查询", "那么它从查询到数据返回", "我要返回这两个字段", "都可以用这同一条索引", "这就叫索引覆盖", "我们再举一个例子", "大家看这两个语句啊", "首先第一个语句啊", "select 3个字段", "inventuid store id 和 film id ", "然后在这个表里面就原表", "根据 store id 去过滤", "好下一个语句", "select 也是这个三个字段", "但是又加了一个字段", "last update from 也是老的表啊", "都用老的表", "查询条件在这", "我们把这两个最后一句去看一下执行计划他是什么样的", "好，第一个啊", "explain ，我把语句直接贴在这儿", "我放大一下", "你看这是什么意思啊", "先复习一下这个 SQL 语句啊", "inventuid store id 、 film id 查询这三个字段", "where 2到 id 等于一", "在这个表里面", "首先它能不能走索引", "为什么 store id 等于一", "可以走", "这个字段是那个联合索引的带头字段", "所以他可以走这个 store id ", "film my id 组成的这个联合索引去查询", "但是啊，它返回这三个字段的时候", "好", "为什么可以走索引覆盖呢", "因为你看我们这个查询计划", "extra 是索引覆盖， using index ", "他最后啊", "为什么他不用回表", "因为我们之前的那个 SQL 语句是返回的 store id 和 feel my id ", "你知道 store id 和 feel my id", "是这个联合索引的两个字段", "所以联合索引里面已经包含了", "这两个字段的信息", "它不用回表去查询", "那么请问 inventor id 多了", "这个字段是什么", "为什么加上这个他也不用回表呢", "因为 inventory id 是主键", "也就是说我们的联合索引里面", "是不是不光有这个排序用的字段", "还有这个组件啊", "它是本来是用来回表用的这个组件", "我特定的 film id 和 store id", "这个查询条件查出来了之后", "我查的是什么主键", "然后我再用主键去回表查询其他的字段", "但是现在 MYSQL 发现", "我用这个 store id 查询出来之后", "我要返回的字段是 film id 和 inviter id ", "它全部包含在了这一条索引里面", "所以它还是能走索引覆盖", "好吧", "那我们再看一下下一个", "看这个语句是什么", "比上边的那个有什么区别", "其实都是一模一样的", "最后多返回了一个字段叫 last update ", "这也是这个数据表里面的", "最后更新时间的这个字段啊", "后面的查询条件都是一样的", "好，我们看一下", "你猜这个能不能走索引覆盖", "回车执行", "来看， possible keys k ", "他为什么使用了这条索引呢", "因为我的查询条件是这条联合索引的左边的字段", "所以它可以使用这个联合索引去搜索", "符合我威尔条件的数据记录", "但是咱们再往下看", "这个 extra 是 N ", "extra 是 now ，说明什么", "他没有走索引覆盖", "它最后回表了回主索引去搜索数据了", "为什么我们多返回了一个 last update 字段", "你多返回了这个 last update 字段", "在这条索引里面是没有的", "它没有这个 last update 字段的信息", "所以他必须要拿到主键", "就是这个 in ventuid 之后回据促索引", "回主索引", "再把整个行记录取出来", "把 last update 解析出来", "所以这条语句一定是浪费时间的", "如果你不需要 last update 这个字段", "你就不要写在这个 select 里面", "因为你写了之后", "他反而可能会对效率有极大的影响", "不光是因为他要多组织数据", "而且是因为他要多查一次索引要回表", "这个时间浪费是很大的", "好，我们总结一下今天的内容啊", "它可以通过取消回表的操作提升查询效率", "覆盖索引", "把一次 B 加数的搜索减少", "从两次减少到一次啊", "如果数据的查询不只使用了一个索引", "则不是覆盖索引", "也就是说我的用 where 搜索的时候", "需要使用一条索引", "我返回所有的数据", "要使用同一条索引", "就一条索引解决问题", "不是就不是索引", "覆盖或者叫覆盖索引", "我们可以怎么优化 SQL 语句呢", "第一，优化不需要的数据啊", "我 select 的数据如果不需要的话", "我就不需要 select 出来", "而且尽量要少写什么这种 select 星这种", "因为你不知道不需要的数据", "它可能会多走一条索引", "或者是多重回一次表", "对效率的影响非常的大", "或者是什么呢", "或者是我们可以优化联合索引", "比如说啊", "如果我们这张表只有这个 store id 这一个索引", "它是单独的索引", "它不是联合索引", "那样的话，我们前面那几条查询语句", "是不是都走不了索引覆盖", "那我们可以把这条单个的索引", "把它优化成联合索引", "把 store id 放在前面", "那么的话呢，也不影响用 store id 去查询数据", "更能增加索引覆盖的这个概率", "但是这个也是有代价的", "我的索引的容量变大了", "索引的数据变多了啊", "是不是占磁盘的空间就变大了", "所以我们有收获总是有代价的", "好，这一小节的内容就到这里，谢谢大家", "5-2"]