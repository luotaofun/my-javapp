["大家好", "接下来我们进入项目实战环节", "首先完成系统的登录注册模块", "先来看一下需求", "当我们的用户在登录的时候", "可以输入账号", "在我们的美食社交 app 这个应用中", "咱们的账号可以是手机号", "或者说他自己在个人中心中设置的用户名", "或者说是邮箱", "然后呢是密码啊", "这样的话就可以完成用户的登录", "如果说用户没有账号", "那么就是注册的流程了", "到注册的话", "这里我们可能要求用户要输入手机号码", "然后给他发送验证码", "通过短信发送验证码以后", "进入到下一个页面", "在下一个页面中", "它必须呢输入刚才收到的验证码", "并且我们为了防止恶意频繁的发送验证码", "在这里做了一个60秒的处理", "说白了就是把这个验证码给它设置一个失效时间", "存在 REDIS 里边", "然后通过页面上的一个按钮", "禁用这样的一个功能来实现", "不让他频繁的去发送验证码", "那么下面呢，我们来分析一下", "如果说要完成登录注册的话", "我们在数据库里边建表的时候", "大概都有哪些字段", "根据目前我们的这个业务场景", "那应该就是有用户名、密码、手机号", "我们分析的话", "那我们看到的这个地方是有一个头像的", "那可能我们还需要有一个头像的字段", "一般我们都是存一个图片的地址", "那么头像的话", "因为我们把像图片这种呢", "会存在一个第三方的图片服务器里边", "然后在数据库里边只需要存一个地址即可", "然后我们这里可能还需要", "比如创建时间", "用户最后登录的时间", "这个当前的用户它是否可用", "是否有效等等一些公共属性字段", "这样的话我们把表呢", "就大概的分析了一下", "其实这里我们说一下", "我们可能还需要用到邮箱 email ", "因为我们用户比如说注册成功之后", "为什么", "登录到我们的应用中", "一般都会有一个个人中心对吧", "在个人中心中我们可以设置头像啊", "然后验证我们的邮箱啊等等", "那后续我们可能还要把这些字段给它加上", "好，那下面的话我们就来看一下", "我们详细的登录流程的一个分析", "我这里给大家准备了一个完整的流程图", "根据流程图", "我们大致预览一下", "我们主要呢分为三条主线", "第一条主线就是正常登录", "第二条主线就是我们的注册", "第三条主线就是找回密码", "那我们先来看一下正常登录", "正常登录客户端这边发起一个请求", "他的请求里边呢", "肯定是携带了我们的账号", "那么账号的话可以是用户名、可以是邮箱", "可以是手机号", "还有密码", "到我们的后台程序之后", "我们去做一些参数的健壮性的处理和校验", "然后完成登录流程", "那如果说在这个地方校验没有通过", "比如说账号密码有误", "就会进入到找回密码的环节", "这个我们最后再说", "如果说用户进入我们的应用", "它没有账号", "那他选择了注册", "就会进入我们的第二条主线注册", "注册的时候", "首先用户输入手机号码", "我们要去做一个校验", "校验这个手机号是否已经注册过", "如果没有注册，继续往下", "我们会发送一个六位的随机验证码", "通过短信的方式来发送", "那么在这里的话", "我们可能为了防止用户恶意的去发送验证码", "在这儿我们会去做一个处理", "首先我们会在页面上将我们的按钮禁用", "并且给它显示一个60秒的倒计时", "60秒到了", "然后再解除按钮", "那么60秒到了以后", "说白了也就是这个验证码就失效了", "那么关于验证码失效存储在哪这部分呢", "功能实现我们交给 REDIS 来做", "把验证码存到 REDIS 里面", "设置一个一分钟的失效时间", "然后验证码发送完成之后", "他会输入用户名", "包括刚才收到的验证码以及密码", "发起请求到我们的后台", "到后台以后", "我们在这里要去做参数的校验啊", "校验一下非空", "一些建筑性的处理", "校验一下参数的合法性", "然后再来校验一下我们的验证码", "他输入的验证码", "和我们 REDIS 库里边存的验证码是否一致", "我们要去做一个一致性校验", "最后我们还要去处理一下", "看看当前他输入的这个用户名", "数据库中是否已经有了", "如果有的话也要给予提示", "这是完整的一个注册的流程", "在注册的流程时候", "地方我们来看一下有几个点", "首先这个手机号如果说已经注册了对吧", "那我们就可以让他去登录", "或者说他忘记密码了", "那么就找回密码", "是不是就切换到这个功能了", "到这里的时候", "做这些建筑性的处理参数校验", "然后再往下走", "我们来分析一下", "大家思考一下这三个校验可不可以打乱", "或者说可不可以随机的去校验", "比如说先校验用户名", "再校验验证码", "再校验非公参数", "那么大家在看到这的时候", "可以先暂停一下视频", "然后再来直接看视频里面的答案", "思考一下", "那我就直接去说结果了", "其实这里的话", "我们要思考一下", "如果我们不做非公校验", "我们直接就去叫校", "直接校验验证码和用户名", "是不是可能就会出现异常错误", "空指针是吧", "所以说非空是肯定要放在第一步去做的", "我们要保证我们收到的参数是合法的", "是有效的", "因为我们要考虑到多个终端", "比如说 PC 、小程序、 app 等等", "我不知道你传递过来的参数究竟是啥", "所以说我这里要做合法性的校验", "然后再去做验证码的校验", "那为什么不把用户名的校验放在前边呢", "我们来思考一下验证码存在哪", "redis ", "REDIS 是内存型数据库", "数据都是存在内存中的", "我们在这里直接从内存里边加载", "是不是可以", "说白了就是我们系统的性能", "不会受到太大的影响", "但是用户名的一个校验", "是要跟关系数据库打交道的", "我们要进行磁盘 IO 的一个操作", "如果说我校验完", "校验完了用户名再去校验验证码", "比如说验证码失效了", "是不是这一步相当于白做了", "或者说不一致", "而且还跟数据库交互了一下，是不是啊", "所以说我们把性能影响比较大的放在最后去做", "当然这个也不是绝对的", "是因为咱们现在的这个功能分析下来", "用户名是可以放到最后的", "而且它的对系统的影响也是最大的", "但是在某些场景下", "你比如说你一进来就要去做一些校验", "或者说获取一些核心的参数", "这些参数必须在数据库获取是吧", "哎，那我可能呢就要把它放到第一步", "这个是根据业务来的", "咱们当前这个业务分析下来", "就是要先做非空", "然后把 release 的这个给做了", "因为它的性能影响较低", "这个影响性能影响较高", "我们放到最后", "好，这样的话它的整个流程都是 OK 的情况下", "把数据存储值、关系、数据库完成整个注册的流程", "最后我们让用户实现一个自动登录", "就它注册完直接就登录到应用里边了", "现在基本上都是这样子的是吧", "这样的话，咱们这个用户的登录", "注册的一个流程就分析完了", "那么这里还有一个找回密码", "我给大家布置成作业", "等我们的用户注册登录系统开发完之后", "大家基于这个系统", "把找回密码的功能去写一下", "如果遇到问题", "在评论讨论区留言", "我会给大家进行详细的解答", "然后咱们再来说一下", "我们还需要做哪些事情啊", "在注册登录的时候", "这个地方呢，没有体现出来", "我去补充一下", "我们注册登录在这个模块里边", "我们还要完成一个单点登录的功能是吧", "当时给大家说的", "那我们来说一下什么是单点登录啊", "其实单点登录指的就是我们一个大的项目", "进行模块的拆分", "把这些模块的全部都拆成一个一个的服务", "然后每一个服务呢", "其实都是独立开发、独立部署的", "独立部署之后", "它就会有独自的 IP 地址加端口", "那么也就意味着", "用户只要访问到当前这个大的项目", "下边的每一个服务的时候", "首先要做的第一件事情是什么", "登录", "对不对", "因为你访问到这个服务的时候", "它是独立的 IP 地址", "你要去做一下身份认证吗", "你访问到另一个服务", "又要去做身份认证", "但是我们在现实生活中去思考一下", "我们有这样去访问过这些网站吗", "比如说京东、淘宝等等", "豆瓣没有吧", "基本上就是登录一次", "然后就可以在整个系统随意的地方去进行访问", "因为咱们这个系统下边的这些服务", "为什么", "说白了就是它属于同一个系统", "它们相互之间是授信的", "是可信的", "所以说我们要让用户在一个地方登录完", "就可以实现在这些服务下的一个免登录的效果", "这种场景我们就把它称之为是单点登录", "咱们的系统里边也会去做这个功能", "怎么来实现呢", "我们使用 spring 、 security 和 auto 来实现这个功能", "所以说我们要去搭建授权认证中心", "就是用我刚才说到的那两个技术来实现", "security 在项目中扮演的是认证的角色", "auto 在项目中扮演的是授权的角色", "然后我们在授权的时候", "是通过令牌 token 的机制来进行授权的", "那么这个 token 肯定是要有一个地方用于存储", "我们使用 REDIS 来实现", "把 token 令牌存到 REDIS 中", "为什么要用 REDIS 呢", "因为 REDIS 数据呢，是存在内存里边的", "首先它读取速度很快", "而且在我们的项目中", "他扮演的是一个跨进程之间的", "一个共享的存储服务", "然后我们还要去接入一下网关 spring cloud gateway ", "因为后期呢，我们这个项目啊，模块比较多", "那我们的子服务就比较多", "然后我们通过网关提供一个统一的入口", "通过网关这里再去做统一的身份的一个校验", "除了注册登录的流程之外", "我们还要再去实现一个授权认证中心啊", "要搭建这样的一个环境", "来解决我们单点登录的问题", "好，这样的话我们", "呃，业务的需求分析啊", "下面我们就进入到代码环节", "就先说到这里", "3-3 认证中心需求分析"]